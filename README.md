 **TO MAP LIVE CYBER ATTACKS USING SECURITY INFORMATION AND EVENT MANAGER(SIEM)**


Objective : Setting up Azure Sentinel(cloud based SIEM) to map live cyber attacks .
In this project we use a Virtual Machine in the cloud which is going to be a honey pot(Make it vulnerable) and we collect the records of ip addresses of the attackers using powershell script and send the data to the third party API to geolocate the attacks.

Create  a VM (exposed)
We use Log Analytics Workspace(To collect the data)
Setup Azure Sentinel(SIEM) (To create a map to map the attacker data)
We use Powershell (To extract ip addresses from the windows) and send it to third party API(will derive the latitude , longitude and send it to VM) 


STEPS :
In Azure Portal:
* Create all the resources under same resource group
* Create a VM - create a new inbound rule in Networking section (windows)
* Create Log Analytic Workspace 
* Security Centre - setting - defender plans on - servers on, sql off  then -data collection - All events
* Connect Log analytics - VM and connect
* Create Sentinel - pick log analytics
* Open VM and copy IP - Open Remote Desktop 

In Remote Desktop :
* Open Event Viewer - Here we can find the people who fail to login to our vm
* We collect those ip addresses systematically(using PowerShell)
* Now turn off the firewall protection on VM(remote desktop)
* Open PowerShell and run the following PowerShell script{Hyperlink}
* In this script you need get your own API_KEY from the website{Hyperlink}(ipgeolocation.io)
* By using the PowerShell script we can grab all the logs(failed) and send them to the API and get the geolocation from the API and create log files. (Stores in       $LOGFILE_PATH )

Again we go back to Azure Portal:
* Go to Log analytics - Custom log - create a custom log
* Copy the LOGFILE from remote desktop and Create a file(failed_rdp_log) in your desktop Note : this failed_rdp_log will be used in “creating custom log” in azure
“In Collection paths'' select windows and paste the path of the LOGFILE from Remote Desktop(VM).
* Next fill the details section and Create Custom Log(cl)
* Then go to “logs” and run the custom log(cl) - We run the logs from the LOGFILE generated by PowerShell. 
* Expand one of the Logs and Click the Actions(“...”) then we need to extract each field (attributes such as latitude , longitude) and save each extractions(custom fields).
* And finally run the Custom log again - we can find each extraction(custom field) as column in the logs section.
 Note: Each Custom field can be modified in Custom Logs section
* Create a “New workbook” in Azure Sentinel
* Run the following query - **FAILED_RDP_WITH_GEO_CL | summarize event_count=count() by sourcehost_CF, latitude_CF, longitude_CF, country_CF, label_CF, destinationhost_CF
| where destinationhost_CF != "samplehost"
| where sourcehost_CF != ""**
* Select Visualisation as “Map”
* Set the Map Setting according to our purpose
* Save the Map and wait for the attacks.
* After a while we get the attacks from various countries.
* Collect the data from the map.

Conclusion :

* SIEM makes it easier for enterprises to manage security by filtering massive amounts of security data and prioritising the security alerts the software generates.SIEM software enables organisations to detect incidents that may otherwise go undetected..
* SIEM system also enhances incident management by enabling the company's security team to uncover the route an attack takes across the network, identify the sources that were compromised and provide the automated tools to prevent the attacks in progress.
* In this Project with the help of SIEM analytics of Azure Sentinel we are able to demonstrate and map a live cyber attack on our Virtual Machine.
